# ğŸ—ï¸ Platform Architecture

Detailed architecture documentation for the Kubernetes platform.

---

## High-Level Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        KUBERNETES CLUSTER (K3s)                      â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  k3s-master    â”‚    â”‚  k3s-worker1   â”‚    â”‚  k3s-worker2   â”‚   â”‚
â”‚  â”‚  (Control      â”‚    â”‚  (Worker       â”‚    â”‚  (Worker       â”‚   â”‚
â”‚  â”‚   Plane)       â”‚    â”‚   Node)        â”‚    â”‚   Node)        â”‚   â”‚
â”‚  â”‚                â”‚    â”‚                â”‚    â”‚                â”‚   â”‚
â”‚  â”‚  â€¢ API Server  â”‚    â”‚  â€¢ Kubelet     â”‚    â”‚  â€¢ Kubelet     â”‚   â”‚
â”‚  â”‚  â€¢ etcd        â”‚    â”‚  â€¢ Container   â”‚    â”‚  â€¢ Container   â”‚   â”‚
â”‚  â”‚  â€¢ Scheduler   â”‚    â”‚    Runtime     â”‚    â”‚    Runtime     â”‚   â”‚
â”‚  â”‚  â€¢ Controller  â”‚    â”‚  â€¢ Workloads   â”‚    â”‚  â€¢ Workloads   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â”‚                     â”‚                     â”‚            â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                 â”‚                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                           â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚   APPLICATION    â”‚        â”‚   INFRASTRUCTUREâ”‚
          â”‚      LAYER       â”‚        â”‚      LAYER      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

### 1. Application Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           FULL-STACK TODO APPLICATION            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   FRONTEND     â”‚  React.js + Material-UI     â”‚
â”‚  â”‚   (2 replicas) â”‚  Port: 30800                â”‚
â”‚  â”‚   Nginx        â”‚                             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚          â”‚ HTTP/REST                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   BACKEND      â”‚  Node.js + Express          â”‚
â”‚  â”‚   (2 replicas) â”‚  Port: 3000                 â”‚
â”‚  â”‚   API Server   â”‚  REST API endpoints         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚          â”‚ PostgreSQL Protocol                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚  â”‚   DATABASE     â”‚  PostgreSQL 16              â”‚
â”‚  â”‚   (3 replicas) â”‚  CloudNativePG              â”‚
â”‚  â”‚   HA Cluster   â”‚  Primary + 2 Replicas       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. Observability Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              OBSERVABILITY TRIAD                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ METRICS  â”‚  â”‚   LOGS   â”‚  â”‚  TRACES  â”‚      â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚  â”‚Prometheusâ”‚  â”‚   Loki   â”‚  â”‚  Jaeger  â”‚      â”‚
â”‚  â”‚  +       â”‚  â”‚    +     â”‚  â”‚    +     â”‚      â”‚
â”‚  â”‚ Grafana  â”‚  â”‚ Promtail â”‚  â”‚  Agent   â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â”‚
â”‚       â”‚             â”‚             â”‚             â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â”‚                     â”‚                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚              â”‚   GRAFANA   â”‚                    â”‚
â”‚              â”‚  Dashboards â”‚                    â”‚
â”‚              â”‚   Port:     â”‚                    â”‚
â”‚              â”‚    30300    â”‚                    â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3. Operations Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 CI/CD & BACKUP                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚     ArgoCD       â”‚    â”‚     Velero       â”‚  â”‚
â”‚  â”‚   (GitOps CD)    â”‚    â”‚   + MinIO        â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚ â€¢ Git Sync       â”‚    â”‚ â€¢ Daily Backups  â”‚  â”‚
â”‚  â”‚ â€¢ Auto Deploy    â”‚    â”‚ â€¢ S3 Storage     â”‚  â”‚
â”‚  â”‚ â€¢ Rollback       â”‚    â”‚ â€¢ Disaster       â”‚  â”‚
â”‚  â”‚ â€¢ Multi-tenancy  â”‚    â”‚   Recovery       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚       HPA        â”‚    â”‚      Helm        â”‚  â”‚
â”‚  â”‚  (Autoscaling)   â”‚    â”‚  (Pkg Manager)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. Security Layer
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 SECURITY STACK                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      NETWORK POLICIES (27+)            â”‚     â”‚
â”‚  â”‚  â€¢ Pod-to-Pod Firewall                 â”‚     â”‚
â”‚  â”‚  â€¢ Namespace Isolation                 â”‚     â”‚
â”‚  â”‚  â€¢ Egress Control                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚      RBAC      â”‚    â”‚  Pod Security   â”‚     â”‚
â”‚  â”‚   (4 Roles)    â”‚    â”‚    Standards    â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ â€¢ Developer    â”‚    â”‚ â€¢ Baseline      â”‚     â”‚
â”‚  â”‚ â€¢ Viewer       â”‚    â”‚   Enforcement   â”‚     â”‚
â”‚  â”‚ â€¢ CI/CD        â”‚    â”‚ â€¢ Audit Mode    â”‚     â”‚
â”‚  â”‚ â€¢ Backup Ops   â”‚    â”‚                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Cert-Manager  â”‚    â”‚    Kyverno      â”‚     â”‚
â”‚  â”‚  (TLS Auto)    â”‚    â”‚  (Policies)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Network Architecture

### Pod Network (Flannel CNI)
```
Pod CIDR: 10.42.0.0/16
Service CIDR: 10.43.0.0/16

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Flannel VXLAN Overlay           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Node 1: 10.42.0.0/24                   â”‚
â”‚  Node 2: 10.42.1.0/24                   â”‚
â”‚  Node 3: 10.42.2.0/24                   â”‚
â”‚                                         â”‚
â”‚  Services: 10.43.0.0/16                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Service Exposure
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Service Types                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  ClusterIP (Internal):                   â”‚
â”‚  â€¢ Backend API                           â”‚
â”‚  â€¢ Database                              â”‚
â”‚  â€¢ Internal services                     â”‚
â”‚                                          â”‚
â”‚  NodePort (External):                    â”‚
â”‚  â€¢ Frontend (30800)                      â”‚
â”‚  â€¢ Grafana (30300)                       â”‚
â”‚  â€¢ Jaeger (16686)                        â”‚
â”‚  â€¢ ArgoCD (32012)                        â”‚
â”‚                                          â”‚
â”‚  LoadBalancer:                           â”‚
â”‚  â€¢ (Using MetalLB - optional)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Storage Architecture
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Storage Architecture              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                          â”‚
â”‚  StorageClass: local-path (default)      â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Persistent Volumes (PV)       â”‚     â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤     â”‚
â”‚  â”‚ â€¢ Prometheus Data              â”‚     â”‚
â”‚  â”‚ â€¢ Grafana Data                 â”‚     â”‚
â”‚  â”‚ â€¢ Loki Data                    â”‚     â”‚
â”‚  â”‚ â€¢ PostgreSQL Data (3x)         â”‚     â”‚
â”‚  â”‚ â€¢ MinIO Data                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                          â”‚
â”‚  Backup Strategy:                        â”‚
â”‚  â€¢ Velero snapshots â†’ MinIO S3           â”‚
â”‚  â€¢ Daily automated backups               â”‚
â”‚  â€¢ Retention: 7 days                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### Request Flow
```
User Request
    â”‚
    â–¼
Browser (http://NODE_IP:30800)
    â”‚
    â–¼
Frontend Service (NodePort 30800)
    â”‚
    â–¼
Frontend Pod (Nginx)
    â”‚
    â–¼ /api/* â†’ proxy_pass
    â”‚
Backend Service (ClusterIP 3000)
    â”‚
    â–¼
Backend Pod (Node.js)
    â”‚
    â–¼ PostgreSQL queries
    â”‚
Database Service (ClusterIP 5432)
    â”‚
    â–¼
PostgreSQL Pod (Primary)
    â”‚
    â–¼
Response back through chain
```

### Monitoring Flow
```
Application Pods
    â”‚
    â”œâ”€â–º Metrics â†’ Prometheus (scrape)
    â”‚                â”‚
    â”‚                â–¼
    â”‚            Grafana (visualize)
    â”‚
    â”œâ”€â–º Logs â†’ Promtail (collect)
    â”‚              â”‚
    â”‚              â–¼
    â”‚          Loki (store)
    â”‚              â”‚
    â”‚              â–¼
    â”‚          Grafana (query)
    â”‚
    â””â”€â–º Traces â†’ Jaeger Agent
                    â”‚
                    â–¼
                Jaeger Collector
                    â”‚
                    â–¼
                Jaeger Query UI
```

---

## Scaling Architecture

### Horizontal Pod Autoscaler (HPA)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Autoscaling Configuration      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                    â”‚
â”‚  Backend:                          â”‚
â”‚  â€¢ Min Replicas: 2                 â”‚
â”‚  â€¢ Max Replicas: 10                â”‚
â”‚  â€¢ Target CPU: 70%                 â”‚
â”‚                                    â”‚
â”‚  Frontend:                         â”‚
â”‚  â€¢ Min Replicas: 2                 â”‚
â”‚  â€¢ Max Replicas: 5                 â”‚
â”‚  â€¢ Target CPU: 80%                 â”‚
â”‚                                    â”‚
â”‚  Database:                         â”‚
â”‚  â€¢ Fixed: 3 replicas               â”‚
â”‚  â€¢ 1 Primary + 2 Replicas          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## High Availability

### Database HA
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    PostgreSQL HA Configuration       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚  â”‚ Primary  â”‚ â—„â”€â”€â”€ Write Requests    â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚       â”‚                              â”‚
â”‚       â”œâ”€â–º Replication                â”‚
â”‚       â”‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Replica1 â”‚    â”‚ Replica2 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚       â”‚               â”‚              â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚               â”‚                      â”‚
â”‚         Read Requests                â”‚
â”‚                                      â”‚
â”‚  â€¢ Automatic Failover                â”‚
â”‚  â€¢ Synchronous Replication           â”‚
â”‚  â€¢ Read Load Balancing               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Architecture

### Defense in Depth
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Security Layers                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  Layer 1: Network                    â”‚
â”‚  â”œâ”€ Network Policies                 â”‚
â”‚  â”œâ”€ Namespace Isolation              â”‚
â”‚  â””â”€ Ingress/Egress Control           â”‚
â”‚                                      â”‚
â”‚  Layer 2: Identity & Access          â”‚
â”‚  â”œâ”€ RBAC Roles                       â”‚
â”‚  â”œâ”€ Service Accounts                 â”‚
â”‚  â””â”€ Secret Management                â”‚
â”‚                                      â”‚
â”‚  Layer 3: Runtime                    â”‚
â”‚  â”œâ”€ Pod Security Standards           â”‚
â”‚  â”œâ”€ Resource Limits                  â”‚
â”‚  â””â”€ Read-only Root Filesystem        â”‚
â”‚                                      â”‚
â”‚  Layer 4: Policy Enforcement         â”‚
â”‚  â”œâ”€ Kyverno Policies                 â”‚
â”‚  â”œâ”€ Admission Controllers            â”‚
â”‚  â””â”€ Automated Compliance             â”‚
â”‚                                      â”‚
â”‚  Layer 5: Monitoring                 â”‚
â”‚  â”œâ”€ Audit Logs                       â”‚
â”‚  â”œâ”€ Security Alerts                  â”‚
â”‚  â””â”€ Anomaly Detection                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Namespace Organization
```
â”œâ”€â”€ kube-system          # Core K8s components
â”œâ”€â”€ monitoring           # Prometheus, Grafana, Loki
â”œâ”€â”€ argocd              # GitOps CD
â”œâ”€â”€ backup              # Velero, MinIO
â”œâ”€â”€ todoapp             # Full-stack application
â”œâ”€â”€ cert-manager        # TLS automation
â”œâ”€â”€ kyverno             # Policy engine
â”œâ”€â”€ kubernetes-dashboard # Web UI
â”œâ”€â”€ ingress-nginx       # Ingress controller (optional)
â””â”€â”€ default             # Default namespace
```

---

## Design Decisions

### Why K3s?

- âœ… Lightweight (< 40MB binary)
- âœ… Full Kubernetes compatibility
- âœ… Single binary deployment
- âœ… Built-in components (Traefik, CoreDNS)
- âœ… Perfect for edge/IoT/dev environments

### Why CloudNativePG?

- âœ… Native Kubernetes operator
- âœ… Automatic failover
- âœ… Backup integration
- âœ… Declarative configuration
- âœ… Production-ready

### Why Separate Observability Tools?

- âœ… Best-in-class for each domain
- âœ… Industry standard (Prometheus, Grafana)
- âœ… Complete visibility
- âœ… Flexible integration

---

## Performance Considerations

### Resource Allocation
```
Total Cluster Resources:
â”œâ”€â”€ CPU: 12 cores (3 nodes Ã— 4 cores)
â”œâ”€â”€ Memory: 24GB (3 nodes Ã— 8GB)
â””â”€â”€ Storage: 90GB (3 nodes Ã— 30GB)

Allocation:
â”œâ”€â”€ System: ~20%
â”œâ”€â”€ Monitoring: ~25%
â”œâ”€â”€ Applications: ~45%
â””â”€â”€ Buffer: ~10%
```

### Optimization Strategies

- Resource requests/limits on all pods
- Horizontal Pod Autoscaling for workloads
- PVC storage class optimization
- Node affinity for critical workloads
- Pod topology spread constraints

---

## Next Steps

- [Installation Guide](01-installation-guide.md)
- [Troubleshooting](04-troubleshooting.md)
